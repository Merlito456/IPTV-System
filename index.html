<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online TV (Dynamic)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: #000; font-family: sans-serif;
      overflow: hidden; user-select: none;
    }
    .tv-container { display: flex; height: 100vh; }
    #video-area {
      flex: 1; position: relative;
      display: flex; align-items: center; justify-content: center;
      background: #000;
    }
    video, iframe, #yt-player { width: 100%; height: 100%; object-fit: contain; }
    #noise {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif') center/cover;
      display: none;
    }
    #overlay {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 24px;
      background: rgba(0, 0, 0, 0.5);
    }
    #channel-panel {
      width: 300px; background: #111; color: #fff;
      overflow-y: auto; transition: transform .3s;
    }
    #channel-panel.hidden { transform: translateX(-100%); }
    .section-header {
      padding: 10px; background: #222; cursor: pointer;
      border-bottom: 1px solid #333;
    }
    .section-content { display: none; flex-direction: column; }
    .section-content.expanded { display: flex; }
    .channel-item {
      padding: 10px; border-bottom: 1px solid #333; cursor: pointer;
    }
    .channel-item:hover { background: #333; }
    #controls {
      position: absolute; top: 10px; left: 10px; z-index: 10;
    }
    .btn {
      background: rgba(0, 0, 0, 0.7); color: #fff;
      padding: 10px 15px; border: none; border-radius: 5px;
      cursor: pointer; margin-bottom: 5px;
    }
    .btn:hover { background: rgba(255, 255, 255, 0.2); }
    #admin-link {
      display: none; position: absolute; top: 10px; right: 10px;
      color: #fff; background: #333;
      padding: 5px 10px; border-radius: 5px;
      text-decoration: none; z-index: 20;
    }
  </style>

  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', function (e) {
      const key = e.key.toLowerCase();
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(key)) || (e.ctrlKey && key === 'u')) {
        e.preventDefault();
        return false;
      }
      if (e.shiftKey && key === 'a') {
        document.getElementById('admin-link').style.display = 'inline';
        alert('Admin link unlocked');
      }
    });
    setInterval(() => {
      if (window.outerWidth - window.innerWidth > 160 || window.outerHeight - window.innerHeight > 160) {
        document.body.innerHTML = "<h1 style='color:white;text-align:center;margin-top:20%;'>üö´ Developer Tools Detected</h1>";
      }
    }, 1000);
  </script>
</head>

<body>
  <div class="tv-container">
    <div id="video-area">
      <div id="noise"></div>
      <div id="overlay">Choose Channel to play</div>
    </div>
    <div id="channel-panel">
      <div class="section-header" data-target="iptv-list">üì∫ IPTV Channels</div>
      <div id="iptv-list" class="section-content expanded"></div>
      <div class="section-header" data-target="youtube-list">üé• YouTube Live Channels</div>
      <div id="youtube-list" class="section-content"></div>
    </div>
  </div>

  <div id="controls">
    <button class="btn" id="toggle-panel">‚ò∞</button>
  </div>

  <a id="admin-link" href="add_channel.php">‚ûï Add Channel</a>

  <script>
    let hls = null, ytPlayer = null, ytApiLoaded = false, pendingVideoId = null;

    function showOverlay(text) { $('#overlay').text(text).show(); }
    function hideOverlay() { $('#overlay').hide(); }
    function showNoise(on) { $('#noise').toggle(on); }

    function clearVideo() {
      if (hls) { hls.destroy(); hls = null; }
      if (ytPlayer && ytPlayer.destroy) { ytPlayer.destroy(); ytPlayer = null; }
      $('#video-area').find('video, #yt-player').remove();
    }

    function playIPTV(url) {
      clearVideo(); showOverlay('Loading...'); showNoise(false);
      const video = $('<video autoplay muted controls playsinline>').appendTo('#video-area');
      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video[0]);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { video[0].play(); hideOverlay(); });
        hls.on(Hls.Events.ERROR, (_, data) => {
          if (data.fatal) showOverlay('‚ùå Playback error');
        });
      } else if (video[0].canPlayType('application/vnd.apple.mpegurl')) {
        video[0].src = url;
        video.on('loadedmetadata', () => { video[0].play(); hideOverlay(); });
      } else {
        showOverlay('‚ùå Format unsupported');
      }
    }

    function loadYouTubeLive(channelId) {
      clearVideo(); showOverlay('Checking YouTube live...'); showNoise(false);
      fetch(`https://vipstreaming.zya.me/get_youtube_live.php?channel_id=${channelId}`)
        .then(r => r.json())
        .then(data => {
          if (data.liveVideoId) {
            pendingVideoId = data.liveVideoId;
            if (!ytApiLoaded) {
              const tag = document.createElement('script');
              tag.src = "https://www.youtube.com/iframe_api";
              document.body.appendChild(tag);
              ytApiLoaded = true;
            } else {
              createYTPlayer(pendingVideoId);
            }
          } else {
            showOverlay('üî¥ Channel not live');
            showNoise(true);
          }
        })
        .catch(() => {
          showOverlay('‚ùå Failed to load YouTube');
          showNoise(true);
        });
    }

    function createYTPlayer(videoId) {
      $('<div id="yt-player">').appendTo('#video-area');
      ytPlayer = new YT.Player('yt-player', {
        height: '100%', width: '100%', videoId,
        playerVars: { autoplay: 1, controls: 1, modestbranding: 1, rel: 0, playsinline: 1 },
        events: {
          onReady: e => { e.target.playVideo(); hideOverlay(); },
          onError: () => showOverlay('‚ùå YouTube playback error')
        }
      });
    }

    window.onYouTubeIframeAPIReady = () => {
      if (pendingVideoId) {
        createYTPlayer(pendingVideoId);
        pendingVideoId = null;
      }
    };

    function loadChannels() {
      fetch('https://vipstreaming.zya.me/external/channels.json')
        .then(r => r.json())
        .then(data => {
          const iptv = $('#iptv-list').empty();
          const yt = $('#youtube-list').empty();
          if (Array.isArray(data.channels)) {
            data.channels.forEach(ch => {
              if (ch.stream_url) {
                iptv.append(`<div class="channel-item" data-type="iptv" data-stream="${encodeURI(ch.stream_url)}">${ch.name}</div>`);
              } else if (ch.youtube_channel_id) {
                yt.append(`<div class="channel-item" data-type="youtube" data-youtubeid="${ch.youtube_channel_id}">${ch.name}</div>`);
              }
            });
          } else {
            alert("‚ùå Invalid channel data");
          }
        })
        .catch(() => alert('‚ùå Failed to load channels'));
    }

    $('#channel-panel').on('click', '.channel-item', function () {
      const type = $(this).data('type');
      if (type === 'iptv') playIPTV($(this).data('stream'));
      else loadYouTubeLive($(this).data('youtubeid'));
    });

    $('.section-header').click(function () {
      $('#' + $(this).data('target')).toggleClass('expanded');
    });

    $('#toggle-panel').click(() => $('#channel-panel').toggleClass('hidden'));

    window.onload = () => {
      showOverlay('üì° Checking default YouTube channel...');
      showNoise(true);
      loadYouTubeLive('UCLA_DiR1FfKNvjuUpBHmylQ'); // Default NASA Live
      loadChannels();
    };
  </script>
</body>
</html>
